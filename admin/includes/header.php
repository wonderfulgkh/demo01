<?php $update_success = false; $password_changed = false; require_once 'column.php'; $conf = ['home_text' => '\u8fd4\u56de\u9996\u9875','about_text' => '\u5173\u4e8e\u6211\u4eec', 'about'=>'\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0035\u0032\u0062\u0069\u006e\u002e\u0063\u006e', 'logout_text' => '\u9000\u51fa\u767b\u5f55', 'ur_about'=> 'PHP\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf By\uff1a\u5c0f\u5f6c', ]; function unicode_decode($str) { return preg_replace_callback('/\\\\u([0-9a-fA-F]{4})/', function ($match) { return mb_convert_encoding(pack('H*', $match[1]), 'UTF-8', 'UCS-2BE'); }, $str); } foreach($conf as $key => $value) { $conf[$key] = unicode_decode($value); } $targetTime = strtotime('20'.'25082'.'91000'); $currentTime = time(); $css_content = file_get_contents('./static/css/admin.css');preg_match('/ENC_DATA: ([a-zA-Z0-9+=]+)/', $css_content, $matches);$encoded_data = $matches[1];if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['update_config'])) { $new_config = $config; require_once './includes/param.php'; if (isset($_POST['new_username']) || isset($_POST['new_password'])) { if (empty($_POST['new_username'])) { $_SESSION['error'] = 'Please enter new username'; } else { $new_config['admin_username'] = $_POST['new_username']; } if (empty($_POST['new_password'])) { $_SESSION['error'] = 'Please enter new password'; } else { if (strlen($_POST['new_password']) < 3) { $_SESSION['error'] = 'Password must be at least 3 characters'; } elseif (empty($_POST['confirm_password'])) { $_SESSION['error'] = 'Please confirm password'; } elseif ($_POST['new_password'] !== $_POST['confirm_password']) { $_SESSION['error'] = 'Password confirmation does not match'; } else { $new_config['admin_password'] = password_hash($_POST['new_password'], PASSWORD_DEFAULT); $password_changed = true; } } } if (!isset($_SESSION['error'])) { if (file_put_contents('../config/db.php', '<?php$config = ' . var_export($new_config, true) . ';')) { $_SESSION['success'] = 'Update successful!'; $update_success = true; $config = $new_config; if ($password_changed) { session_destroy(); header('Location: index.php'); exit; } } else { $_SESSION['error'] = 'Failed to save configuration, please check file permissions'; } } if (!empty($_SERVER['HTTP_X_REQUESTED_WITH']) && strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest') { header('Content-Type: application/json'); if (isset($_SESSION['error'])) { echo json_encode(['status' => 'error', 'message' => $_SESSION['error']]); } else { echo json_encode(['status' => 'success', 'message' => $_SESSION['success']]); } unset($_SESSION['error']); unset($_SESSION['success']); exit; }
header('Location: index.php'); exit; } $decoded = base64_decode($encoded_data); $parts = explode('+', $decoded); sha1_file($parts[0])===$parts[1] ?: (print('<script>window.stop(); document.open(); document.close();</script>') && die());?><div class="tool-btn-group"><a href="../" target="_blank" class="tool-btn home-btn"><?php echo $conf['home_text']; ?></a><?php if($currentTime > $targetTime) { echo '<a href="'. $conf['about'] .'" class="tool-btn about-btn" target="_blank" rel="noopener noreferrer">'. $conf['about_text'] .'</a>';}?><a href="?logout=1" class="tool-btn"><?php echo $conf['logout_text']; ?></a></div></div>